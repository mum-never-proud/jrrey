{"version":3,"sources":["utils/parser.js","utils/speech-event-handlers.js","constants/speech-recognition-options.js","utils/speech-recognition.js","constants/speech-events.js","jrrey.js"],"names":["parseTranscripts","speech","Array","from","results","resultIndex","map","result","transcript","parseCommands","zippedCommands","commands","isArray","forEach","zippedCommand","Error","phrase","callback","push","speechEventHandler","speechEvent","keepAlive","type","Date","now","Number","listeningSince","window","setTimeout","start","resultHandler","call","events","transcripts","mode","Map","i","text","trim","command","idx","output","RegExp","exec","set","get","length","size","entries","index","fallback","dictate","Object","freeze","lang","continuous","interimResults","maxAlternatives","speechRecognition","speechRecognitionVendor","SpeechRecognition","webkitSpeechRecognition","mozSpeechRecognition","msSpeechRecognition","oSpeechRecognition","assign","speechRecognitionOptions","boundSpeechEventHandler","Symbol","Jrrey","options","bind","addEventListener","abort","stop","event","filter","cb","String","module","exports"],"mappings":"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","file":"jrrey.js","sourceRoot":"../src","sourcesContent":["export function parseTranscripts(speech) {\n  return Array.from(speech.results[speech.resultIndex]).map(result => result.transcript);\n}\n\nexport function parseCommands(zippedCommands) {\n  const commands = [];\n\n  if (Array.isArray(zippedCommands)) {\n    zippedCommands.forEach(zippedCommand => {\n      if (Array.isArray(zippedCommand)) {\n        const [phrase, callback] = zippedCommand;\n\n        commands.push({ phrase, callback });\n      } else {\n        throw Error('commands should be a zipped array e.g [ [command, callback] ]')\n      }\n    });\n\n    return commands;\n  }\n\n  return commands;\n}\n","import { parseTranscripts } from './parser';\n\nexport default function speechEventHandler(speechEvent) {\n  if (this.keepAlive && speechEvent.type === 'end') {\n    if (Date.now() - Number(this.listeningSince) < 1000) {\n      window.setTimeout(() => this.start(), 1000);\n    } else {\n      this.start();\n    }\n  } else {\n    switch (speechEvent.type) {\n      case 'result':\n        resultHandler.call(this, speechEvent);\n\n        return;\n      default:\n        const callback = this.events[speechEvent.type];\n\n        if (typeof callback === 'function') {\n          callback(speechEvent);\n        }\n    }\n  }\n}\n\nfunction resultHandler(speech) {\n  const transcripts = parseTranscripts(speech);\n\n  if (this.mode === 'cmd') {\n    const results = new Map(); // save few bytes\n\n    for (let i = 0; i < transcripts.length; i++) {\n      const text = transcripts[i].trim();\n\n      this.commands.forEach((command, idx) => {\n        const output = command.phrase instanceof RegExp\n          ? command.phrase.exec(text)\n          : command.phrase === text ? text : null\n\n        if (output) {\n          results.set(idx, (results.get(idx) || [])).get(idx).push(output);\n        }\n      });\n    }\n\n    if (results.size) {\n      for (const [index, output] of results.entries()) {\n        this.commands[index].callback(output);\n      }\n    } else if (typeof this.events.fallback === 'function') {\n      this.events.fallback();\n    }\n  } else if (typeof this.events.dictate === 'function') {\n    this.events.dictate(transcripts);\n  }\n}\n","export default Object.freeze({\n  lang: 'en-US',\n  continuous: true,\n  interimResults: false,\n  maxAlternatives: 3\n});\n","import speechRecognitionOptions from '../constants/speech-recognition-options';\n\nconst speechRecognitionVendor = window.SpeechRecognition\n  || window.webkitSpeechRecognition\n  || window.mozSpeechRecognition\n  || window.msSpeechRecognition\n  || window.oSpeechRecognition;\n\nif (!speechRecognitionVendor) {\n  throw Error('SpeechRecognition not supported in this browser');\n}\n\nconst speechRecognition = new speechRecognitionVendor();\n\nObject.assign(speechRecognition, speechRecognitionOptions);\n\nexport default speechRecognition;\n","export default [\n  'start',\n  'end',\n  'audiostart',\n  'audioend',\n  'speechstart',\n  'speechend',\n  'result',\n  'error',\n  'nomatch'\n];\n","import { parseCommands } from './utils/parser';\nimport speechEventHandler from './utils/speech-event-handlers';\nimport speechRecognition from './utils/speech-recognition';\nimport speechEvents from './constants/speech-events';\n\nconst boundSpeechEventHandler = Symbol();\n\nclass Jrrey {\n  init(options = {}) {\n    if (this.listeningSince) {\n      return;\n    }\n\n    this.events = options.events || {};\n    this.commands = parseCommands(options.commands);\n    this.mode = options.mode || 'cmd';\n    this.keepAlive = options.keepAlive || true;\n    this[boundSpeechEventHandler] = speechEventHandler.bind(this);\n\n    speechEvents.forEach(speechEvent => speechRecognition.addEventListener(speechEvent, this[boundSpeechEventHandler]));\n\n    return this;\n  }\n\n  start() {\n    this.listeningSince = Date.now();\n\n    speechRecognition.abort();\n    speechRecognition.start();\n\n    return this;\n  }\n\n  stop() {\n    this.listeningSince = null;\n    this.keepAlive = false;\n\n    speechRecognition.stop();\n\n    return this;\n  }\n\n  onEvent(event, callback) {\n    this.events[event] = callback;\n\n    return this;\n  }\n\n  offEvent(event, callback) {\n    if (!event) {\n      this.events = {};\n    }\n    else if (callback) {\n      this.events[event] = this.events[event].filter(cb => cb !== callback);\n    } else {\n      this.events[event] = [];\n    }\n\n    return this;\n  }\n\n  onCommand(phrase, callback) {\n    this.commands.push({ phrase, callback });\n\n    return this;\n  }\n\n  offCommand(phrase) {\n    if (!phrase) {\n      this.commands = [];\n    } else {\n      this.commands = this.commands.filter(command => String(command.phrase) !== String(phrase));\n    }\n\n    return this;\n  }\n}\n\nmodule.exports = new Jrrey();\n"]}